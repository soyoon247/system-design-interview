# 뉴스 피드 시스템 설계

## 서비스
- 포스팅 저장 서비스 : 포스팅을 디비와 캐시에 저장
- 포스팅 전송 서비스 : 새 포스팅을 친구의 뉴스 피드에 푸시
- 알림 서비스 : 새 포스팅이 왔음을 알리는 역할


## 피드 발행
포스팅 전송 = 팬아웃은 새 포스팅을 친구 관계의 사용자에게 전달하는 과정 
### 푸시 모델 (쓰기 시점에 팬아웃)
- 장점 : 쓸 때 갱신되므로 뉴스 피드를 읽는 데 드는 시간 단축
- 단점 : 친구가 많은 사용자의 경우, 뉴스 피드 갱신에 많은 시간 소요(핫키), 서비스를 자주 이용하지 않는 사용자의 피드까지 갱신하므로 컴퓨팅 자원 낭비

### 풀 모델 (읽기 시점에 팬아웃)
- 장점 : 로그인 전까지는 어떤 자원도 소모하지 않음, 핫키 문제 없음
- 단점 : 뉴스 피드 읽을 때 시간이 많이 소요된다. 

### 두 가지 방법을 결합
- 대부분의 사용자는 푸시 모델
- 친구가 많은 경우 풀 모델
- 안정 해시 사용하여 핫키 문제 해소

### 플로우
    1. 그래프 디비에서 친구 ID 조회
    2. 사용자 정보 캐시에서 친구들 정보 조회 + 친구 필터링
    3. 친구 목록과 포스팅ID를 메시지 큐에 넣음
    4. 큐에서 꺼내어 뉴스 피드 데이터를 뉴스 피드 캐시에 넣는다. (포스팅 ID, 사용자 ID) -> 대부분 최신 스토리만 보기 때문에 이 캐시 크기에 제한을 둬도 괜찮다.


## 피드 읽기
    - 미디어 콘텐츠는 CDN에 저장
    1. 뉴스 피드 서비스가 뉴스 피드 캐시에서 포스팅 ID 목록 가져온다
    2. 사용자 캐시와 포스팅 캐시 -> 사용자 이름, 사진, 포스팅 콘텐츠 등을 가져와 뉴스 피드를 만든다
    3. 클라이언트에 전송
